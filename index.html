<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>аче сайт</title>
        <link rel="shortcut icon" href="IMGs/icon.png">
        <link rel="stylesheet" type="text/css" href="CSS/style.css">
        <link rel="stylesheet" type="text/css" href="ICONS/style.css">
        <link rel="stylesheet" title="theme" href="CSS/theme-dark.css">
    </head>
    <body>
        <div class="theme">
            <svg class="change-theme" data-theme="light" width="40" height="40" viewBox="0 0 40 40" fill="#fff" xmlns="http://www.w3.org/2000/svg"> <path d="M20 30C22.6522 30 25.1957 28.9464 27.0711 27.0711C28.9464 25.1957 30 22.6522 30 20C30 17.3478 28.9464 14.8043 27.0711 12.9289C25.1957 11.0536 22.6522 10 20 10C17.3478 10 14.8043 11.0536 12.9289 12.9289C11.0536 14.8043 10 17.3478 10 20C10 22.6522 11.0536 25.1957 12.9289 27.0711C14.8043 28.9464 17.3478 30 20 30V30ZM20 0C20.3315 0 20.6495 0.131696 20.8839 0.366117C21.1183 0.600537 21.25 0.918479 21.25 1.25V6.25C21.25 6.58152 21.1183 6.89946 20.8839 7.13388C20.6495 7.3683 20.3315 7.5 20 7.5C19.6685 7.5 19.3505 7.3683 19.1161 7.13388C18.8817 6.89946 18.75 6.58152 18.75 6.25V1.25C18.75 0.918479 18.8817 0.600537 19.1161 0.366117C19.3505 0.131696 19.6685 0 20 0V0ZM20 32.5C20.3315 32.5 20.6495 32.6317 20.8839 32.8661C21.1183 33.1005 21.25 33.4185 21.25 33.75V38.75C21.25 39.0815 21.1183 39.3995 20.8839 39.6339C20.6495 39.8683 20.3315 40 20 40C19.6685 40 19.3505 39.8683 19.1161 39.6339C18.8817 39.3995 18.75 39.0815 18.75 38.75V33.75C18.75 33.4185 18.8817 33.1005 19.1161 32.8661C19.3505 32.6317 19.6685 32.5 20 32.5V32.5ZM40 20C40 20.3315 39.8683 20.6495 39.6339 20.8839C39.3995 21.1183 39.0815 21.25 38.75 21.25H33.75C33.4185 21.25 33.1005 21.1183 32.8661 20.8839C32.6317 20.6495 32.5 20.3315 32.5 20C32.5 19.6685 32.6317 19.3505 32.8661 19.1161C33.1005 18.8817 33.4185 18.75 33.75 18.75H38.75C39.0815 18.75 39.3995 18.8817 39.6339 19.1161C39.8683 19.3505 40 19.6685 40 20ZM7.5 20C7.5 20.3315 7.3683 20.6495 7.13388 20.8839C6.89946 21.1183 6.58152 21.25 6.25 21.25H1.25C0.918479 21.25 0.600537 21.1183 0.366117 20.8839C0.131696 20.6495 0 20.3315 0 20C0 19.6685 0.131696 19.3505 0.366117 19.1161C0.600537 18.8817 0.918479 18.75 1.25 18.75H6.25C6.58152 18.75 6.89946 18.8817 7.13388 19.1161C7.3683 19.3505 7.5 19.6685 7.5 20ZM34.1425 5.8575C34.3768 6.09191 34.5085 6.40979 34.5085 6.74125C34.5085 7.07271 34.3768 7.39059 34.1425 7.625L30.6075 11.1625C30.4913 11.2786 30.3533 11.3706 30.2016 11.4333C30.0498 11.4961 29.8871 11.5283 29.7229 11.5282C29.3912 11.528 29.0731 11.396 28.8387 11.1612C28.7227 11.045 28.6307 10.9071 28.5679 10.7553C28.5052 10.6035 28.4729 10.4409 28.4731 10.2766C28.4733 9.94491 28.6053 9.62689 28.84 9.3925L32.375 5.8575C32.6094 5.62316 32.9273 5.49152 33.2588 5.49152C33.5902 5.49152 33.9081 5.62316 34.1425 5.8575V5.8575ZM11.16 28.84C11.3943 29.0744 11.526 29.3923 11.526 29.7237C11.526 30.0552 11.3943 30.3731 11.16 30.6075L7.625 34.1425C7.38925 34.3702 7.07349 34.4962 6.74575 34.4933C6.418 34.4905 6.10449 34.359 5.87273 34.1273C5.64097 33.8955 5.50951 33.582 5.50666 33.2543C5.50381 32.9265 5.6298 32.6108 5.8575 32.375L9.3925 28.84C9.62691 28.6057 9.94479 28.474 10.2762 28.474C10.6077 28.474 10.9256 28.6057 11.16 28.84V28.84ZM34.1425 34.1425C33.9081 34.3768 33.5902 34.5085 33.2588 34.5085C32.9273 34.5085 32.6094 34.3768 32.375 34.1425L28.84 30.6075C28.6123 30.3717 28.4863 30.056 28.4892 29.7282C28.492 29.4005 28.6235 29.087 28.8552 28.8552C29.087 28.6235 29.4005 28.492 29.7282 28.4892C30.056 28.4863 30.3717 28.6123 30.6075 28.84L34.1425 32.375C34.3768 32.6094 34.5085 32.9273 34.5085 33.2588C34.5085 33.5902 34.3768 33.9081 34.1425 34.1425ZM11.16 11.1625C10.9256 11.3968 10.6077 11.5285 10.2762 11.5285C9.94479 11.5285 9.62691 11.3968 9.3925 11.1625L5.8575 7.625C5.73811 7.50969 5.64288 7.37176 5.57737 7.21926C5.51186 7.06675 5.47738 6.90273 5.47594 6.73675C5.47449 6.57078 5.50612 6.40618 5.56897 6.25256C5.63182 6.09894 5.72464 5.95937 5.84201 5.84201C5.95937 5.72464 6.09894 5.63182 6.25256 5.56897C6.40618 5.50612 6.57078 5.47449 6.73675 5.47594C6.90273 5.47738 7.06675 5.51186 7.21926 5.57737C7.37176 5.64288 7.50969 5.73811 7.625 5.8575L11.16 9.3925C11.2764 9.50861 11.3688 9.64655 11.4318 9.79842C11.4948 9.95028 11.5272 10.1131 11.5272 10.2775C11.5272 10.4419 11.4948 10.6047 11.4318 10.7566C11.3688 10.9084 11.2764 11.0464 11.16 11.1625V11.1625Z"></path></svg>
            <svg class="change-theme" data-theme="dark" width="38" height="40" viewBox="0 0 38 40" fill="#333" xmlns="http://www.w3.org/2000/svg"> <path d="M15 0.695136C15.244 0.991667 15.3935 1.35457 15.4292 1.73694C15.4648 2.11932 15.385 2.5036 15.2 2.84014C13.7546 5.49382 12.9998 8.46837 13.005 11.4901C13.005 21.5426 21.2 29.6826 31.3 29.6826C32.6175 29.6826 33.9 29.5451 35.1325 29.2826C35.5103 29.2008 35.9039 29.2321 36.264 29.3726C36.6241 29.5131 36.9349 29.7566 37.1575 30.0726C37.3925 30.4013 37.5123 30.7983 37.4983 31.2021C37.4842 31.6058 37.3372 31.9936 37.08 32.3051C35.1192 34.7137 32.6456 36.6544 29.8396 37.9856C27.0335 39.3168 23.9658 40.0051 20.86 40.0001C9.335 40.0001 0 30.7151 0 19.2751C0 10.6651 5.285 3.28014 12.81 0.150136C13.1848 -0.00828447 13.601 -0.0407995 13.9959 0.057475C14.3908 0.15575 14.7431 0.379507 15 0.695136V0.695136Z"></path></svg>
        </div>
        
        <div class="wrapper"></div>

        <script src="js/script.js"></script>
        <script src="js/theme.js"></script>
        <pre style="display: none;"><code>
import tkinter as tk
from tkinter import simpledialog as sd
        
figures = {
                'king': '♚',
                'queen': '♛',
                'bishop': '♝',
                'knight': '♞',
                'pawn': '♟',
                'rook': '♜'
            }
        
class Chess():
            def __init__(self):
                self.colors = {
                    'board': ['darkgray', 'gray'],
                    'figures': {
                            'white': 'white',
                            'black': 'black'
                        },
                    'selector': ['#829769', '#9cac88'],
                    'selected': ['#ccd26a', '#aaa23a'],
                    'danger': '#d1614e'
                }
                self.history = []
                self.dangerBoard = {}
                self.rotation = True
                self.cnt = 0
                
                self.root = tk.Tk()
                self.root.resizable(0, 0)
                self.root.title('Chessматы')
                
                tk.Button(self.root, text='Restart', command=lambda: self.restart(), width=5).grid(row=0, sticky='w', padx=10, pady=10)
                tk.Button(self.root, text='Rotate', command=lambda: self.rotate(), width=5).grid(row=0, sticky='e', padx=10, pady=10)
                self.label = tk.Label(self.root, text='Ходят Белые')
                self.label.grid(column=0, row=0, pady=10)
                
                self.board = tk.Frame(self.root)
                self.board.grid(column=0, row=1)
                
                self.boardBtns = [[tk.Button(self.board, relief='sunken') for j in range(8)] for i in range(8)]
                
                for y in range(8):
                    for x in range(8):
                        self.boardBtns[y][x].config(font='Arial 20', width=4, height=2, 
                                                    activebackground=self.colors['selector'][0], activeforeground='lightblue')
                        self.boardBtns[y][x].grid(column=x, row=y)
                
                self.restart()
                        
                for i in ''.split():
                    self.htext_to_turn(i)
        
                self.root.mainloop()
            
            def rotate(self):
                ''' Переворот доски на противоположную сторону '''
                for y in range(8):
                    for x in range(8):
                        if self.rotation: self.boardBtns[y][x].grid(column=7-x, row=7-y)
                        else: self.boardBtns[y][x].grid(column=x, row=y)
                self.rotation = not self.rotation
            
            def restart(self):
                ''' Размещение фигур на доске '''
                self.dangerBoard = { 'pos': [[0 for _ in range(8)] for _ in range(8)] }
                print('\n----------------')
                for y in range(8):
                    if y >= 6:
                        color = 'white'
                        state = 'normal'
                        cursor = 'hand2'
                    else:
                        color = 'black'
                        state = 'disabled'
                        cursor = 'arrow'
                    for x in range(8):
                        if y == 1 or y == 6: 
                            self.boardBtns[y][x].config(text= figures['pawn'], fg=self.colors['figures'][color], disabledforeground=self.colors['figures'][color])
                            self.dangerBoard['pos'][y][x] = f'{color}-p'
                        elif y == 0 or y == 7:
                            if x == 0 or x == 7: 
                                self.boardBtns[y][x].config(text= figures['rook'], fg=self.colors['figures'][color], disabledforeground=self.colors['figures'][color])
                                self.dangerBoard['pos'][y][x] = f'{color}-R'
                            elif x == 1 or x == 6: 
                                self.boardBtns[y][x].config(text= figures['knight'], fg=self.colors['figures'][color], disabledforeground=self.colors['figures'][color])
                                self.dangerBoard['pos'][y][x] = f'{color}-N'
                            elif x == 2 or x == 5: 
                                self.boardBtns[y][x].config(text= figures['bishop'], fg=self.colors['figures'][color], disabledforeground=self.colors['figures'][color])
                                self.dangerBoard['pos'][y][x] = f'{color}-B'
                            elif x == 3: 
                                self.boardBtns[y][x].config(text= figures['queen'], fg=self.colors['figures'][color], disabledforeground=self.colors['figures'][color])
                                self.dangerBoard['pos'][y][x] = f'{color}-Q'
                            else: 
                                self.boardBtns[y][x].config(text= figures['king'], fg=self.colors['figures'][color], disabledforeground=self.colors['figures'][color])
                                self.dangerBoard['pos'][y][x] = f'{color}-K'
                        else:
                            self.boardBtns[y][x].config(text='', fg='blue', disabledforeground='blue')
                            self.dangerBoard['pos'][y][x] = 0
                        
                        self.boardBtns[y][x].config(state=state, cursor=cursor, bg=self.colors['board'][(y+x)%2],
                                                    command=lambda value=(y, x): self.in_turn(value))
                    
                self.dangerBoard['pred'] = [[j for j in i] for i in self.dangerBoard['pos']]
                                
                self.danger_check()
            
            def generate_selector(self, old_value, value, roque=False):
                ''' Упрощение комманд '''
                self.boardBtns[value[0]][value[1]].config(command=lambda old_value=old_value, value=value, roque=roque: self.slot_selected(old_value, value, roque), bg=self.colors['selector'][1],
                                                          cursor='hand2', state='normal')
            
            def slot_selected(self, old_value, value, roque=False, htextToTurnSelected=False):
                ''' Выбрана клетка для хотьбы '''
                self.cnt = 0
                if not roque:
                    if self.boardBtns[old_value[0]][old_value[1]]['text'] ==  figures['knight']: htext = 'N'
                    elif self.boardBtns[old_value[0]][old_value[1]]['text'] ==  figures['pawn']: htext = 'p'
                    else: htext = [i for i in  figures][[ figures[i] for i in  figures].index(self.boardBtns[old_value[0]][old_value[1]]['text'])][0].upper()
                    htext = f'{htext}{'abcdefgh'[old_value[1]]}{8-old_value[0]}x{'abcdefgh'[value[1]]}{8-value[0]}'
                else:
                    if value[1] == 6: htext = 'O-O'
                    else: htext = 'O-O-O'
                
                if self.boardBtns[old_value[0]][old_value[1]]['text'] ==  figures['pawn'] and (value[0] == 0 or value[0] == 7):
                    if not htextToTurnSelected: self.choose_figure()
                    else: self.choosedFigure = htextToTurnSelected
                    
                    if self.choosedFigure == 'knight': htext += '=N'
                    else: htext += f'={self.choosedFigure[0].upper()}'

                    self.boardBtns[old_value[0]][old_value[1]]['text'] =  figures[self.choosedFigure]
                    self.dangerBoard['pos'][old_value[0]][old_value[1]] = self.dangerBoard['pos'][old_value[0]][old_value[1]][:-1] + htext[-1]
                    
                self.history.append(htext)
                print(self.history[-1], end=' ')
                
                self.dangerBoard['pos'][value[0]][value[1]] = self.dangerBoard['pos'][old_value[0]][old_value[1]]
                self.dangerBoard['pos'][old_value[0]][old_value[1]] = 0
                
                if self.dangerBoard['pos'][value[0]][value[1]][:-2] == 'white': self.label.config(text='Ходят Чёрные')
                else: self.label.config(text='Ходят Белые')
                
                self.boardBtns[value[0]][value[1]].config(text=self.boardBtns[old_value[0]][old_value[1]]['text'],
                                                          fg=self.boardBtns[old_value[0]][old_value[1]]['fg'],
                                                          disabledforeground=self.boardBtns[old_value[0]][old_value[1]]['fg'])
                self.boardBtns[old_value[0]][old_value[1]].config(text='', fg='blue')
                
                if roque:
                    if htext == 'O-O': roqR = 1
                    else: roqR = -1
                    self.boardBtns[value[0]][value[1]-roqR].config(text=self.boardBtns[value[0]][value[1]+roqR]['text'],
                                                            fg=self.boardBtns[value[0]][value[1]+roqR]['fg'],
                                                            disabledforeground=self.boardBtns[value[0]][value[1]+roqR]['fg'])
                    self.boardBtns[value[0]][value[1]+roqR].config(text='', fg='blue')
                    self.dangerBoard['pos'][value[0]][value[1]-roqR] = self.dangerBoard['pos'][value[0]][value[1]+roqR]
                    self.dangerBoard['pos'][value[0]][value[1]+roqR] = 0
                
                self.danger_check()
                
                for y in range(8):
                    for x in range(8):
                        self.boardBtns[y][x].config(state='disabled', cursor='arrow',
                                                    command=lambda value=(y, x): self.in_turn(value))
                        if self.boardBtns[y][x]['text'] != '' and self.boardBtns[y][x]['fg'] != self.boardBtns[value[0]][value[1]]['fg']:
                            self.boardBtns[y][x].config(state='normal', cursor='hand2')
                            if self.boardBtns[y][x]['text'] ==  figures['king']:
                                dangerBoard = self.dangerBoard['check'][[i for i in self.colors['figures']][[i for i in self.colors['figures']].index(self.dangerBoard['pred'][y][x][:-2])-1]]
                                if dangerBoard[y][x]:
                                    self.boardBtns[y][x].config(bg=self.colors['danger'])
                                    if self.checkmate_check(self.dangerBoard['pred'][y][x][:-2]): self.label.config(text='Мат!')
                                elif not dangerBoard[y][x] and self.checkmate_check(self.dangerBoard['pred'][y][x][:-2]): self.label.config(text='Пат!')
                
                if roque:
                    self.boardBtns[value[0]][value[1]+roqR]['bg'] = self.colors['selected'][1]
                    self.boardBtns[old_value[0]][old_value[1]]['bg'] = self.colors['selected'][0]
                else:
                    self.boardBtns[value[0]][value[1]]['bg'] = self.colors['selected'][1]
                    self.boardBtns[old_value[0]][old_value[1]]['bg'] = self.colors['selected'][0]
                    
            def choose_figure(self, figure=0):
                ''' Пешка дошла до конца и идёт выбор фигуры '''
                if not figure: figureChoose(self.root, 'Выбор фигуры')
                else:
                    self.choosedFigure = figure
                    
            def in_turn(self, value):
                ''' Выбрана фигура для хотьбы '''
                for y in range(8):
                    for x in range(8):
                        if y == value[0] and x == value[1]: continue
                        self.boardBtns[y][x].config(state='disabled', cursor='arrow', bg=self.colors['board'][(y+x)%2],
                                                    command=lambda value=(y, x): self.in_turn(value))
                        if self.boardBtns[y][x]['fg'] == self.boardBtns[value[0]][value[1]]['fg']:
                            self.boardBtns[y][x].config(state='normal', cursor='hand2')
                            if self.boardBtns[y][x]['text'] ==  figures['king']:
                                dangerBoard = self.dangerBoard['check'][[i for i in self.colors['figures']][[i for i in self.colors['figures']].index(self.dangerBoard['pred'][y][x][:-2])-1]]
                                if dangerBoard[y][x]: self.boardBtns[y][x].config(bg=self.colors['danger'])
                if self.boardBtns[value[0]][value[1]]['bg'] != self.colors['selector'][0]:
                    self.boardBtns[value[0]][value[1]].config(bg=self.colors['selector'][0], state='normal', cursor='hand2')
                    if self.boardBtns[value[0]][value[1]]['text'] ==  figures['king']: self.king_turn(value[0], value[1])
                    elif self.boardBtns[value[0]][value[1]]['text'] ==  figures['pawn']: self.pawn_turn(value[0], value[1])
                    elif self.boardBtns[value[0]][value[1]]['text'] ==  figures['knight']: self.knight_turn(value[0], value[1])
                    elif self.boardBtns[value[0]][value[1]]['text'] ==  figures['bishop']: self.bishop_turn(value[0], value[1])
                    elif self.boardBtns[value[0]][value[1]]['text'] ==  figures['rook']: self.rook_turn(value[0], value[1])
                    elif self.boardBtns[value[0]][value[1]]['text'] ==  figures['queen']: self.queen_turn(value[0], value[1])
                else:
                    for y in range(8):
                        for x in range(8):
                            self.boardBtns[y][x].config(state='disabled', cursor='arrow', bg=self.colors['board'][(y+x)%2],
                                                        command=lambda value=(y, x): self.in_turn(value))
                            if self.boardBtns[value[0]][value[1]]['fg'] == self.boardBtns[y][x]['fg']:
                                self.boardBtns[y][x].config(state='normal', cursor='hand2')
                            if self.boardBtns[y][x]['text'] ==  figures['king']:
                                dangerBoard = self.dangerBoard['check'][[i for i in self.colors['figures']][[i for i in self.colors['figures']].index(self.dangerBoard['pred'][y][x][:-2])-1]]
                                if dangerBoard[y][x]: self.boardBtns[y][x].config(bg=self.colors['danger'])
            
            def king_turn(self, y: int, x: int, check=False):
                ''' Передвижение короля '''
                dangerBoard = self.dangerBoard['check'][[i for i in self.colors['figures']][[i for i in self.colors['figures']].index(self.dangerBoard['pred'][y][x][:-2])-1]]
                for dy in range(-1, 2):
                    for dx in range(-1, 2):
                        if dy+y == y and dx+x == x: continue
                        if 8 > dy+y >= 0 and 8 > dx+x >= 0 and (self.boardBtns[dy+y][dx+x]['fg'] != self.colors['figures'][self.dangerBoard['pred'][y][x][:-2]] or check) and not dangerBoard[dy+y][dx+x]:
                                if not check:
                                    if self.danger_prediction((y, x), (dy+y, dx+x)): self.generate_selector((y, x), (dy+y, dx+x))
                                else: self.dangerBoard['check'][self.dangerBoard['pred' if check else 'pos'][y][x][:-2]][y+dy][x+dx] = 1
        
                if x == 4 and (y == 0 or y ==7) and len(self.history) and not check and not dangerBoard[y][x]:
                    for i in self.history:
                        if f'Ke{8-y}x' in i: return
                    self.roque(y, x, dangerBoard)
            
            def roque(self, y: int, x: int, dbrd):
                ''' Ракировка короля '''
                for i in range(len(self.history)):
                    if 'O-' in self.history[i] and self.colors['figures'][[j for j in self.colors['figures']][i%2]] == self.boardBtns[y][x]['fg']:
                        return
                small, big = True, True
                if self.dangerBoard['pred'][y][x+1] == 0 and self.dangerBoard['pred'][y][x+2] == 0 and not dbrd[y][x+1] and not dbrd[y][x+2]:
                    for i in self.history:
                        if f'Rh{8-y}x' in i: small = False
                    if small: self.generate_selector((y, x), (y, x+2), True)
                if self.dangerBoard['pred'][y][x-1] == 0 and self.dangerBoard['pred'][y][x-2] == 0 and self.dangerBoard['pred'][y][x-3] == 0 and not dbrd[y][x-1] and not dbrd[y][x-2] and not dbrd[y][x-3]:
                    for i in self.history:
                        if f'Ra{8-y}x' in i: big = False
                    if big: self.generate_selector((y, x), (y, x-3), True)
            
            def pawn_turn(self, y: int, x: int, check=False):
                ''' Передвижение пешки '''
                if self.dangerBoard['pred'][y][x][:-2] == 'white': index = -1
                else: index = 1
                
                if 8 > y+index >= 0 and self.dangerBoard['pred'][y+index][x] == 0 and not check:
                    if (y == 1 or y == 6) and 8 > y+index*2 >= 0 and self.dangerBoard['pred'][y+index*2][x] == 0:
                        if self.danger_prediction((y, x), (y+index*2, x)): self.generate_selector((y, x), (y+index*2, x))
                    if self.danger_prediction((y, x), (y+index, x)): self.generate_selector((y, x), (y+index, x))
                
                for i in [-1, 1]:
                    if 8 > x+i >= 0 and 8 > y+index >= 0 and (self.dangerBoard['pred'][y+index][x+i] != 0 or check) and (self.boardBtns[y+index][x+i]['fg'] != self.colors['figures'][self.dangerBoard['pred'][y][x][:-2]] or check):
                        if not check:
                            if self.danger_prediction((y, x), (y+index, x+i)): self.generate_selector((y, x), (y+index, x+i))
                        else:
                            self.dangerBoard['check'][self.dangerBoard['pred' if check else 'pos'][y][x][:-2]][y+index][x+i] = 1
            
            def knight_turn(self, y: int, x: int, check=False):
                ''' Передвижение коня '''
                steps = [(2, 1), (2, -1), (1, 2), (-1, 2), (-2, 1), (-2, -1), (1, -2), (-1, -2)]
                
                for value in steps:
                    ny = value[0]+y
                    nx = value[1]+x
                    if 8 > ny >= 0 and 8 > nx >= 0:
                        if self.dangerBoard['pred'][ny][nx] == 0 or self.dangerBoard['pred'][ny][nx][:-2] != self.dangerBoard['pred'][y][x][:-2]:
                            if not check:
                                if self.danger_prediction((y, x), (ny, nx)): self.generate_selector((y, x), (ny, nx))
                            else: self.dangerBoard['check'][self.dangerBoard['pred' if check else 'pos'][y][x][:-2]][ny][nx] = 1
            
            def bishop_turn(self, y: int, x: int, check=False):
                ''' Передвижение слона '''
                steps = [(-1, 1), (1, 1), (-1, -1), (1, -1)]
                for value in steps:
                    for i in range(1, 8):
                        ny = value[0]*i+y
                        nx = value[1]*i+x
                        if 8 > ny >= 0 and 8 > nx >= 0:
                            if self.dangerBoard['pred'][ny][nx] == 0 or self.dangerBoard['pred'][ny][nx][:-2] != self.dangerBoard['pred'][y][x][:-2]:
                                if not check:
                                    if self.danger_prediction((y, x), (ny, nx)): self.generate_selector((y, x), (ny, nx))
                                else: self.dangerBoard['check'][self.dangerBoard['pred' if check else 'pos'][y][x][:-2]][ny][nx] = 1
                            if self.dangerBoard['pred'][ny][nx] != 0:
                                break
            
            def rook_turn(self, y: int, x: int, check=False):
                ''' Передвижение ладьи '''
                steps = [(1, 0), (-1, 0), (0, 1), (0, -1)]
                for value in steps:
                    for i in range(1, 8):
                        ny = value[0]*i+y
                        nx = value[1]*i+x
                        if 8 > ny >= 0 and 8 > nx >= 0:
                            if self.dangerBoard['pred'][ny][nx] == 0 or self.dangerBoard['pred'][ny][nx][:-2] != self.dangerBoard['pred'][y][x][:-2]:
                                if not check:
                                    if self.danger_prediction((y, x), (ny, nx)): self.generate_selector((y, x), (ny, nx))
                                else: self.dangerBoard['check'][self.dangerBoard['pred' if check else 'pos'][y][x][:-2]][ny][nx] = 1
                            if self.dangerBoard['pred'][ny][nx] != 0:
                                break
            
            def queen_turn(self, y: int, x: int, check=False):
                ''' Передвижение ферзя '''
                self.rook_turn(y, x, check)
                self.bishop_turn(y, x, check)
            
            def danger_check(self, check='pos'):
                ''' Поиск клеток куда могут атакавать фигуры '''
                self.dangerBoard['check'] = {
                    'white': [[0 for _ in range(8)] for _ in range(8)],
                    'black': [[0 for _ in range(8)] for _ in range(8)]
                }
                if check == 'pos': self.dangerBoard['pred'] = [[j for j in i] for i in self.dangerBoard['pos']]
                for y in range(8):
                    for x in range(8):
                        if self.dangerBoard[check][y][x] == 0: continue
                        if self.dangerBoard[check][y][x][-1] == 'p': self.pawn_turn(y, x, True)
                        elif self.dangerBoard[check][y][x][-1] == 'R': self.rook_turn(y, x, True)
                        elif self.dangerBoard[check][y][x][-1] == 'N': self.knight_turn(y, x, True)
                        elif self.dangerBoard[check][y][x][-1] == 'B': self.bishop_turn(y, x, True)
                        elif self.dangerBoard[check][y][x][-1] == 'K': self.king_turn(y, x, True)
                        elif self.dangerBoard[check][y][x][-1] == 'Q': self.queen_turn(y, x, True)
            
            def danger_prediction(self, old_value, value):
                ''' Проверка возможного хода на возможную опасность для короля '''
                ny, nx = value[0], value[1]
                y, x = old_value[0], old_value[1]
                self.dangerBoard['pred'] = [[j for j in i] for i in self.dangerBoard['pos']]
                
                self.dangerBoard['pred'][ny][nx] = self.dangerBoard['pred'][y][x]
                self.dangerBoard['pred'][y][x] = 0
                self.danger_check('pred')
                
                for dy in range(8):
                    for dx in range(8):
                        if self.dangerBoard['pred'][dy][dx]:
                            if self.dangerBoard['pred'][dy][dx][:-2] == self.dangerBoard['pred'][ny][nx][:-2] and self.dangerBoard['pred'][dy][dx][-1] == 'K':
                                if self.dangerBoard['check'][[i for i in self.colors['figures']][[i for i in self.colors['figures']].index(self.dangerBoard['pred'][dy][dx][:-2])-1]][dy][dx]:
                                    self.danger_check()
                                    return False
                                else:
                                    self.danger_check()
                                    self.cnt += 1
                                    return True
            
            def checkmate_check(self, color: str):
                ''' Проверка на поставлен ли мат '''
                # Проверка каждой клетки с фигурой цвета короля под шахом на возможность хода спасающего короля
                for y in range(8):
                    for x in range(8):
                        if self.boardBtns[y][x]['fg'] == self.colors['figures'][color]:
                            self.in_turn((y, x))
                
                # Заметание следов
                for y in range(8):
                    for x in range(8):
                        if self.boardBtns[y][x]['bg'] == self.colors['selector'][0]:
                            self.in_turn((y, x))
                if not self.cnt: return True
                else: return False
            
            def htext_to_turn(self, htext: str):
                ''' Текст истории -> ход фигуры на доске '''
                choosed = False
                for y in range(8):
                    for x in range(8):
                        self.boardBtns[y][x].config(state='disabled', cursor='arrow', bg=self.colors['board'][(y+x)%2],
                                                    command=lambda value=(y, x): self.in_turn(value))
                if 'O-' not in htext:
                    if len(htext) > 6:
                        choosed = htext[-1]
                        if choosed == 'N': choosed = 'knight'
                        elif choosed == 'Q': choosed = 'queen'
                        elif choosed == 'R': choosed = 'rook'
                        elif choosed == 'B': choosed = 'bishop'
                    htext = htext.split('x')
                    fromPos = htext[0][1:]
                    toPos = htext[1][:2]
                    fromPos = (8-int(fromPos[1]),'abcdefgh'.index(fromPos[0]))
                    toPos = (8-int(toPos[1]),'abcdefgh'.index(toPos[0]))
                    self.slot_selected(fromPos, toPos, False, choosed)
                else:
                    if len(self.history)%2: y = 0
                    else: y = 7
                    if htext == 'O-O': x = 6
                    else: x = 1
                    self.slot_selected((y, 4), (y, x), True)
        
class figureChoose(sd.Dialog):
    ''' Всплывающее окно для выбора фигуры когда пешка доходит до края '''
    def choosed(self, fig):
        ''' Вызов функции сохраняющей выбор и закрытие окна '''
        Chess.choose_figure(self=Chess, figure=fig)
        self.cancel()
    
    def buttonbox(self):
        ''' Создание кнопок в модальном окне '''
        self.resizable(0, 0)
        box = tk.Frame(self)
        for i in ['queen', 'knight', 'rook', 'bishop']:
            tk.Button(box, text=figures[i], command=lambda x=i: self.choosed(fig=x), width=4, height=2,
                      font='Arial 20', cursor='hand2', bg='darkgray', activebackground='lightgray').pack(side='left', padx=2)
        box.pack(padx=10, pady=10)
        
if __name__ == '__main__':
            Chess()
        </code></pre>
    </body>
</html>
